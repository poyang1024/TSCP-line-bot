# 登出功能說明

## ✅ 已實現登出功能

### 🚀 如何使用登出功能

#### 方法 1：文字指令
用戶可以輸入以下任何一個指令來登出：
- `登出`
- `會員登出`

#### 方法 2：主選單按鈕
在已登入狀態下：
1. 輸入 `選單` 或 `主選單`
2. 點選 `🔓 會員登出` 按鈕

### 🔧 登出功能詳情

#### 登出時會執行以下操作：
1. **清除用戶狀態** - 從記憶體中移除所有用戶資料
2. **斷開 WebSocket 連線** - 停止接收即時通知
3. **顯示登出成功訊息** - 確認登出完成
4. **顯示登入提示** - 引導用戶重新登入

#### 狀態檢查：
- ✅ **已登入用戶**：執行完整登出流程ㄦ
- ⚠️ **未登入用戶**：顯示「您尚未登入，無需登出」

### 📱 用戶體驗流程

```
用戶輸入「登出」
     ↓
檢查登入狀態
     ↓
[已登入] → 清除狀態 → 斷開連線 → 顯示成功訊息 → 登入提示
[未登入] → 顯示「無需登出」訊息
```

### 🎯 改進的主選單

新的主選單現在使用 **Flex Message** 格式，包含：
- 🔍 搜尋藥局
- 📋 我的訂單  
- 📷 上傳藥單
- 🔓 會員登出 ← **新增**

### 🔒 安全性

- 登出時會自動斷開所有相關連線
- 清除記憶體中的敏感資料（memberId, accessToken）
- 防止未登入用戶的無效操作

### 🧪 測試建議

1. **登入後登出測試**：
   ```
   輸入「登入」→ 完成登入 → 輸入「登出」→ 確認清除狀態
   ```

2. **未登入登出測試**：
   ```
   確保未登入 → 輸入「登出」→ 確認顯示適當訊息
   ```

3. **主選單登出測試**：
   ```
   登入 → 輸入「選單」→ 點選登出按鈕 → 確認執行登出
   ```

### 💡 技術實現

#### 相關文件：
- `src/handlers/messageHandler.ts` - 處理登出指令
- `src/services/userService.ts` - 執行登出邏輯
- `src/templates/messageTemplates.ts` - 主選單添加登出按鈕

#### 函數調用鏈：
```
messageHandler.handleMessage()
    ↓
userService.clearUserState()
    ↓
websocketService.disconnectUserWebSocket()
```

現在用戶可以隨時安全地登出系統！🎉
